# SDR_OS reverse proxy
# Tailscale HTTPS â€” required for Safari Gamepad API (secure context)

https://amd-rtx.tail09c99.ts.net {
    tls /etc/caddy/tls/amd-rtx.tail09c99.ts.net.crt /etc/caddy/tls/amd-rtx.tail09c99.ts.net.key
    log {
        output stdout
        format console
        level INFO
    }

    @healthcheck path /health
    handle @healthcheck {
        skip_log
        respond "OK" 200
    }

    handle /stream/ws {
        reverse_proxy transport-server:8080 {
            flush_interval -1
            transport http {
                read_timeout 0
            }
        }
    }

    @socketio path /socket.io/*
    handle @socketio {
        reverse_proxy node:3000
    }

    handle /ros/* {
        reverse_proxy ros-bridge:9090
    }

    handle /api/* {
        reverse_proxy node:3000
    }

    handle {
        root * /srv/www
        try_files {path} /index.html
        file_server
    }
}
