# SDR_OS reverse proxy
# For Tailscale TLS, replace :80 with your tailscale hostname

:80 {
    handle /health {
        respond "OK" 200
    }

    handle /stream/ws {
        reverse_proxy transport-server:8080 {
            flush_interval -1
            transport http {
                read_timeout 0
            }
        }
    }

    @socketio path /socket.io/*
    handle @socketio {
        reverse_proxy node:3000
    }

    handle /ros/* {
        reverse_proxy ros-bridge:9090
    }

    handle /api/* {
        reverse_proxy node:3000
    }

    handle {
        root * /srv/www
        try_files {path} /index.html
        file_server
    }
}
